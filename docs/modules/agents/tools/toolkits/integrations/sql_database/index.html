<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-modules/agents/tools/toolkits/integrations/sql_database">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">SQL Database Agent | 🦜️🔗 Langchain</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dev2049.github.io/langchain-docs-scratch/img/parrot-chainlink-icon.png"><meta data-rh="true" name="twitter:image" content="https://dev2049.github.io/langchain-docs-scratch/img/parrot-chainlink-icon.png"><meta data-rh="true" property="og:url" content="https://dev2049.github.io/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/sql_database"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SQL Database Agent | 🦜️🔗 Langchain"><meta data-rh="true" name="description" content="This notebook showcases an agent designed to interact with a sql databases. The agent builds off of SQLDatabaseChain and is designed to answer more general questions about a database, as well as recover from errors."><meta data-rh="true" property="og:description" content="This notebook showcases an agent designed to interact with a sql databases. The agent builds off of SQLDatabaseChain and is designed to answer more general questions about a database, as well as recover from errors."><link data-rh="true" rel="icon" href="/langchain-docs-scratch/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://dev2049.github.io/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/sql_database"><link data-rh="true" rel="alternate" href="https://dev2049.github.io/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/sql_database" hreflang="en"><link data-rh="true" rel="alternate" href="https://dev2049.github.io/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/sql_database" hreflang="x-default"><link rel="stylesheet" href="/langchain-docs-scratch/assets/css/styles.42cc9a2a.css">
<link rel="preload" href="/langchain-docs-scratch/assets/js/runtime~main.2adc7ca8.js" as="script">
<link rel="preload" href="/langchain-docs-scratch/assets/js/main.f4d0c746.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/langchain-docs-scratch/"><b class="navbar__title text--truncate">🦜️🔗 LangChain</b></a><a class="navbar__item navbar__link" href="/langchain-docs-scratch/docs/get_started">Docs</a><a href="/langchain-docs-scratch/../api_reference/html/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://js.langchain.com/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">JS/TS Docs</a><a href="https://github.com/hwchase17/langchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="mendable-search"><button class="ms-m-0 msearch-search-btn ms-flex ms-flex-row ms-gap-2 ms-items-center ms-justify-between ms-bg-gray-50 ms-transition-all ms-rounded-xl ms-shadow hover:ms-shadow-md ms-p-1 ms-pl-2 ms-pr-1 sm:ms-p-2 sm:ms-pl-4 sm:ms-pr-2 ms-w-full ms-h-10 ms-outline-none ms-ring-0 hover:ms-cursor-pointer"><div class="search-btn__input-container ms-w-full ms-flex ms-gap-1 ms-items-center ms-min-w-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="search-btn__icon ms-text-gray-400 ms-fill-gray-400 ms-w-5 ms-h-5 sm:ms-w-6 sm:ms-h-6 hover:ms-text-white hover:fill-white focus:ms-text-white focus:ms-fill-white" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg><input disabled="" id="userInput" name="userInput" maxlength="512" placeholder="Search..." class="search-btn__input ms-flex-grow ms-bg-transparent ms-w-full ms-truncate focus:ms-ring-0 focus:ms-ring-transparent focus:ms-outline-none ms-ring-0 ms-ring-transparent ms-outline-none ms-text-sm sm:ms-text-base hover:ms-cursor-text"></div><div class="search-btn__shortcut ms-z-10 ms-gap-1 ms-items-center ms-rounded-lg ms-flex ms-py-[2px] ms-px-[8px] disabled:ms-bg-opacity-10 ms-transition-all ms-flex-row ms-text-xs ms-text-gray-400 ms-border"><span>CTRL</span><span>K</span></div></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Get started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/get_started/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/get_started/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/get_started/quickstart">Quickstart</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Modules</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/model_io/">Model I/​O</a><button aria-label="Toggle the collapsible sidebar category &#x27;Model I/​O&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/data_io/">Data I/​O</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data I/​O&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/chains/">Chains</a><button aria-label="Toggle the collapsible sidebar category &#x27;Chains&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/memory/">Memory</a><button aria-label="Toggle the collapsible sidebar category &#x27;Memory&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/">Agents</a><button aria-label="Toggle the collapsible sidebar category &#x27;Agents&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/agent_types/">Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Types&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/how_to/agent_vectorstore">How-to</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/">Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/how_to/custom_tools">How-to</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/integrations/apify">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/">Toolkits</a><button aria-label="Toggle the collapsible sidebar category &#x27;Toolkits&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/azure_cognitive_services">Integrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/azure_cognitive_services">Azure Cognitive Services Toolkit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/csv">CSV Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/gmail">Gmail Toolkit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/jira">Jira</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/json">JSON Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/openapi">OpenAPI agents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/openapi_nla">Natural Language APIs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/pandas">Pandas Dataframe Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/playwright">PlayWright Browser Toolkit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/powerbi">PowerBI Dataset Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/python">Python Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/spark">Spark Dataframe Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/spark_sql">Spark SQL Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/sql_database">SQL Database Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/vectorstore">Vectorstore Agent</a></li></ul></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/langchain-docs-scratch/docs/modules/callbacks/">Callbacks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Callbacks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/langchain-docs-scratch/docs/use_cases">Use cases</a><button aria-label="Toggle the collapsible sidebar category &#x27;Use cases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/langchain-docs-scratch/docs/guides">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/langchain-docs-scratch/docs/ecosystem">Ecosystem</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ecosystem&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/langchain-docs-scratch/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Modules</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/langchain-docs-scratch/docs/modules/agents/"><span itemprop="name">Agents</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/langchain-docs-scratch/docs/modules/agents/tools/"><span itemprop="name">Tools</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/"><span itemprop="name">Toolkits</span></a><meta itemprop="position" content="4"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Integrations</span><meta itemprop="position" content="5"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SQL Database Agent</span><meta itemprop="position" content="6"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>SQL Database Agent</h1><p>This notebook showcases an agent designed to interact with a sql databases. The agent builds off of <a href="https://langchain.readthedocs.io/en/latest/modules/chains/examples/sqlite.html" target="_blank" rel="noopener noreferrer">SQLDatabaseChain</a> and is designed to answer more general questions about a database, as well as recover from errors.</p><p>Note that, as this agent is in active development, all answers might not be correct. Additionally, it is not guaranteed that the agent won&#x27;t perform DML statements on your database given certain questions. Be careful running it on sensitive data!</p><p>This uses the example Chinook database. To set it up follow the instructions on <a href="https://database.guide/2-sample-databases-sqlite/" target="_blank" rel="noopener noreferrer">https://database.guide/2-sample-databases-sqlite/</a>, placing the .db file in a notebooks folder at the root of this repository.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initialization">Initialization<a href="#initialization" class="hash-link" aria-label="Direct link to Initialization" title="Direct link to Initialization">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agents </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> create_sql_agent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agent_toolkits </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> SQLDatabaseToolkit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sql_database </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> SQLDatabase</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">llms</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">openai </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agents </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> AgentExecutor</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">db </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> SQLDatabase</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">from_uri</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;sqlite:///../../../../notebooks/Chinook.db&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">toolkit </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> SQLDatabaseToolkit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent_executor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> create_sql_agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    llm</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">OpenAI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">temperature</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    toolkit</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">toolkit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    verbose</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-describing-a-table">Example: describing a table<a href="#example-describing-a-table" class="hash-link" aria-label="Direct link to Example: describing a table" title="Direct link to Example: describing a table">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Describe the playlisttrack table&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div lang="python"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: list_tables_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: Artist, Invoice, Playlist, Genre, Album, PlaylistTrack, Track, InvoiceLine, MediaType, Employee, Customer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should look at the schema of the playlisttrack table</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: schema_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;PlaylistTrack&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;PlaylistTrack&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;PlaylistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;TrackId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;PlaylistId&quot;, &quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;TrackId&quot;) REFERENCES &quot;Track&quot; (&quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;PlaylistId&quot;) REFERENCES &quot;Playlist&quot; (&quot;PlaylistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;PlaylistTrack&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    PlaylistId TrackId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3402</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3389</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3390</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I now know the final answer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Final Answer: The PlaylistTrack table has two columns, PlaylistId and TrackId, and is linked to the Playlist and Track tables.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Finished chain.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &#x27;The PlaylistTrack table has two columns, PlaylistId and TrackId, and is linked to the Playlist and Track tables.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-describing-a-table-recovering-from-an-error">Example: describing a table, recovering from an error<a href="#example-describing-a-table-recovering-from-an-error" class="hash-link" aria-label="Direct link to Example: describing a table, recovering from an error" title="Direct link to Example: describing a table, recovering from an error">​</a></h2><p>In this example, the agent tries to search for a table that doesn&#x27;t exist, but finds the next best result</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Describe the playlistsong table&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div lang="python"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: list_tables_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: Genre, PlaylistTrack, MediaType, Invoice, InvoiceLine, Track, Playlist, Customer, Album, Employee, Artist</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should look at the schema of the PlaylistSong table</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: schema_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;PlaylistSong&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: Error: table_names {&#x27;PlaylistSong&#x27;} not found in database</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should check the spelling of the table</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: list_tables_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: Genre, PlaylistTrack, MediaType, Invoice, InvoiceLine, Track, Playlist, Customer, Album, Employee, Artist</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: The table is called PlaylistTrack</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: schema_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;PlaylistTrack&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;PlaylistTrack&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;PlaylistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;TrackId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;PlaylistId&quot;, &quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;TrackId&quot;) REFERENCES &quot;Track&quot; (&quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;PlaylistId&quot;) REFERENCES &quot;Playlist&quot; (&quot;PlaylistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;PlaylistTrack&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    PlaylistId TrackId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3402</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3389</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3390</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I now know the final answer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Final Answer: The PlaylistTrack table contains two columns, PlaylistId and TrackId, which are both integers and are used to link Playlist and Track tables.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Finished chain.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &#x27;The PlaylistTrack table contains two columns, PlaylistId and TrackId, which are both integers and are used to link Playlist and Track tables.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-running-queries">Example: running queries<a href="#example-running-queries" class="hash-link" aria-label="Direct link to Example: running queries" title="Direct link to Example: running queries">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;List the total sales per country. Which country&#x27;s customers spent the most?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div lang="python"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: list_tables_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: Invoice, MediaType, Artist, InvoiceLine, Genre, Playlist, Employee, Album, PlaylistTrack, Track, Customer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should look at the schema of the relevant tables to see what columns I can use.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: schema_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;Invoice, Customer&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;Customer&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;CustomerId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;FirstName&quot; NVARCHAR(40) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;LastName&quot; NVARCHAR(20) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Company&quot; NVARCHAR(80), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Address&quot; NVARCHAR(70), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;City&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;State&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Country&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;PostalCode&quot; NVARCHAR(10), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Phone&quot; NVARCHAR(24), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Fax&quot; NVARCHAR(24), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Email&quot; NVARCHAR(60) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;SupportRepId&quot; INTEGER, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;CustomerId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;SupportRepId&quot;) REFERENCES &quot;Employee&quot; (&quot;EmployeeId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;Customer&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CustomerId FirstName LastName Company Address City State Country PostalCode Phone Fax Email SupportRepId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 Luís Gonçalves Embraer - Empresa Brasileira de Aeronáutica S.A. Av. Brigadeiro Faria Lima, 2170 São José dos Campos SP Brazil 12227-000 +55 (12) 3923-5555 +55 (12) 3923-5566 luisg@embraer.com.br 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    2 Leonie Köhler None Theodor-Heuss-Straße 34 Stuttgart None Germany 70174 +49 0711 2842222 None leonekohler@surfeu.de 5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    3 François Tremblay None 1498 rue Bélanger Montréal QC Canada H2G 1A7 +1 (514) 721-4711 None ftremblay@gmail.com 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;Invoice&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;InvoiceId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;CustomerId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;InvoiceDate&quot; DATETIME NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;BillingAddress&quot; NVARCHAR(70), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;BillingCity&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;BillingState&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;BillingCountry&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;BillingPostalCode&quot; NVARCHAR(10), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Total&quot; NUMERIC(10, 2) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;InvoiceId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;CustomerId&quot;) REFERENCES &quot;Customer&quot; (&quot;CustomerId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;Invoice&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    InvoiceId CustomerId InvoiceDate BillingAddress BillingCity BillingState BillingCountry BillingPostalCode Total</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 2 2009-01-01 00:00:00 Theodor-Heuss-Straße 34 Stuttgart None Germany 70174 1.98</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    2 4 2009-01-02 00:00:00 Ullevålsveien 14 Oslo None Norway 0171 3.96</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    3 8 2009-01-03 00:00:00 Grétrystraat 63 Brussels None Belgium 1000 5.94</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should query the Invoice and Customer tables to get the total sales per country.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: query_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: SELECT c.Country, SUM(i.Total) AS TotalSales FROM Invoice i INNER JOIN Customer c ON i.CustomerId = c.CustomerId GROUP BY c.Country ORDER BY TotalSales DESC LIMIT 10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: [(&#x27;USA&#x27;, 523.0600000000003), (&#x27;Canada&#x27;, 303.9599999999999), (&#x27;France&#x27;, 195.09999999999994), (&#x27;Brazil&#x27;, 190.09999999999997), (&#x27;Germany&#x27;, 156.48), (&#x27;United Kingdom&#x27;, 112.85999999999999), (&#x27;Czech Republic&#x27;, 90.24000000000001), (&#x27;Portugal&#x27;, 77.23999999999998), (&#x27;India&#x27;, 75.25999999999999), (&#x27;Chile&#x27;, 46.62)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I now know the final answer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Final Answer: The customers from the USA spent the most, with a total of $523.06.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Finished chain.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &#x27;The customers from the USA spent the most, with a total of $523.06.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Show the total number of tracks in each playlist. The Playlist name should be included in the result.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div lang="python"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: list_tables_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: Invoice, MediaType, Artist, InvoiceLine, Genre, Playlist, Employee, Album, PlaylistTrack, Track, Customer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should look at the schema of the Playlist and PlaylistTrack tables to see what columns I can use.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: schema_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;Playlist, PlaylistTrack&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;Playlist&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;PlaylistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Name&quot; NVARCHAR(120), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;PlaylistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;Playlist&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    PlaylistId Name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 Music</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    2 Movies</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    3 TV Shows</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;PlaylistTrack&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;PlaylistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;TrackId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;PlaylistId&quot;, &quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;TrackId&quot;) REFERENCES &quot;Track&quot; (&quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;PlaylistId&quot;) REFERENCES &quot;Playlist&quot; (&quot;PlaylistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;PlaylistTrack&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    PlaylistId TrackId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3402</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3389</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 3390</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I can use a SELECT statement to get the total number of tracks in each playlist.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: query_checker_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: SELECT Playlist.Name, COUNT(PlaylistTrack.TrackId) AS TotalTracks FROM Playlist INNER JOIN PlaylistTrack ON Playlist.PlaylistId = PlaylistTrack.PlaylistId GROUP BY Playlist.Name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT Playlist.Name, COUNT(PlaylistTrack.TrackId) AS TotalTracks FROM Playlist INNER JOIN PlaylistTrack ON Playlist.PlaylistId = PlaylistTrack.PlaylistId GROUP BY Playlist.Name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: The query looks correct, I can now execute it.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: query_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: SELECT Playlist.Name, COUNT(PlaylistTrack.TrackId) AS TotalTracks FROM Playlist INNER JOIN PlaylistTrack ON Playlist.PlaylistId = PlaylistTrack.PlaylistId GROUP BY Playlist.Name LIMIT 10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: [(&#x27;90’s Music&#x27;, 1477), (&#x27;Brazilian Music&#x27;, 39), (&#x27;Classical&#x27;, 75), (&#x27;Classical 101 - Deep Cuts&#x27;, 25), (&#x27;Classical 101 - Next Steps&#x27;, 25), (&#x27;Classical 101 - The Basics&#x27;, 25), (&#x27;Grunge&#x27;, 15), (&#x27;Heavy Metal Classic&#x27;, 26), (&#x27;Music&#x27;, 6580), (&#x27;Music Videos&#x27;, 1)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I now know the final answer.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Final Answer: The total number of tracks in each playlist are: &#x27;90’s Music&#x27; (1477), &#x27;Brazilian Music&#x27; (39), &#x27;Classical&#x27; (75), &#x27;Classical 101 - Deep Cuts&#x27; (25), &#x27;Classical 101 - Next Steps&#x27; (25), &#x27;Classical 101 - The Basics&#x27; (25), &#x27;Grunge&#x27; (15), &#x27;Heavy Metal Classic&#x27; (26), &#x27;Music&#x27; (6580), &#x27;Music Videos&#x27; (1).</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Finished chain.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;The total number of tracks in each playlist are: &#x27;90’s Music&#x27; (1477), &#x27;Brazilian Music&#x27; (39), &#x27;Classical&#x27; (75), &#x27;Classical 101 - Deep Cuts&#x27; (25), &#x27;Classical 101 - Next Steps&#x27; (25), &#x27;Classical 101 - The Basics&#x27; (25), &#x27;Grunge&#x27; (15), &#x27;Heavy Metal Classic&#x27; (26), &#x27;Music&#x27; (6580), &#x27;Music Videos&#x27; (1).&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recovering-from-an-error">Recovering from an error<a href="#recovering-from-an-error" class="hash-link" aria-label="Direct link to Recovering from an error" title="Direct link to Recovering from an error">​</a></h2><p>In this example, the agent is able to recover from an error after initially trying to access an attribute (<code>Track.ArtistId</code>) which doesn&#x27;t exist.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Who are the top 3 best selling artists?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div lang="python"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: list_tables_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: MediaType, Track, Invoice, Album, Playlist, Customer, Employee, InvoiceLine, PlaylistTrack, Genre, Artist</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should look at the schema of the Artist, InvoiceLine, and Track tables to see what columns I can use.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: schema_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: &quot;Artist, InvoiceLine, Track&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;Artist&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;ArtistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Name&quot; NVARCHAR(120), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;ArtistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;Artist&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ArtistId Name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 AC/DC</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    2 Accept</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    3 Aerosmith</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;Track&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;TrackId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Name&quot; NVARCHAR(200) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;AlbumId&quot; INTEGER, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;MediaTypeId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;GenreId&quot; INTEGER, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Composer&quot; NVARCHAR(220), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Milliseconds&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Bytes&quot; INTEGER, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;UnitPrice&quot; NUMERIC(10, 2) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;MediaTypeId&quot;) REFERENCES &quot;MediaType&quot; (&quot;MediaTypeId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;GenreId&quot;) REFERENCES &quot;Genre&quot; (&quot;GenreId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;AlbumId&quot;) REFERENCES &quot;Album&quot; (&quot;AlbumId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;Track&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    TrackId Name AlbumId MediaTypeId GenreId Composer Milliseconds Bytes UnitPrice</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 For Those About To Rock (We Salute You) 1 1 1 Angus Young, Malcolm Young, Brian Johnson 343719 11170334 0.99</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    2 Balls to the Wall 2 2 1 None 342562 5510424 0.99</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    3 Fast As a Shark 3 2 1 F. Baltes, S. Kaufman, U. Dirkscneider &amp; W. Hoffman 230619 3990994 0.99</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CREATE TABLE &quot;InvoiceLine&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;InvoiceLineId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;InvoiceId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;TrackId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;UnitPrice&quot; NUMERIC(10, 2) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;Quantity&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        PRIMARY KEY (&quot;InvoiceLineId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;TrackId&quot;) REFERENCES &quot;Track&quot; (&quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FOREIGN KEY(&quot;InvoiceId&quot;) REFERENCES &quot;Invoice&quot; (&quot;InvoiceId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT * FROM &#x27;InvoiceLine&#x27; LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    InvoiceLineId InvoiceId TrackId UnitPrice Quantity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    1 1 2 0.99 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    2 1 4 0.99 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    3 2 6 0.99 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should query the database to get the top 3 best selling artists.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: query_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: SELECT Artist.Name, SUM(InvoiceLine.Quantity) AS TotalQuantity FROM Artist INNER JOIN Track ON Artist.ArtistId = Track.ArtistId INNER JOIN InvoiceLine ON Track.TrackId = InvoiceLine.TrackId GROUP BY Artist.Name ORDER BY TotalQuantity DESC LIMIT 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: Error: (sqlite3.OperationalError) no such column: Track.ArtistId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    [SQL: SELECT Artist.Name, SUM(InvoiceLine.Quantity) AS TotalQuantity FROM Artist INNER JOIN Track ON Artist.ArtistId = Track.ArtistId INNER JOIN InvoiceLine ON Track.TrackId = InvoiceLine.TrackId GROUP BY Artist.Name ORDER BY TotalQuantity DESC LIMIT 3]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    (Background on this error at: https://sqlalche.me/e/14/e3q8)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I should double check my query before executing it.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: query_checker_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: SELECT Artist.Name, SUM(InvoiceLine.Quantity) AS TotalQuantity FROM Artist INNER JOIN Track ON Artist.ArtistId = Track.ArtistId INNER JOIN InvoiceLine ON Track.TrackId = InvoiceLine.TrackId GROUP BY Artist.Name ORDER BY TotalQuantity DESC LIMIT 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SELECT Artist.Name, SUM(InvoiceLine.Quantity) AS TotalQuantity </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    FROM Artist </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    INNER JOIN Track ON Artist.ArtistId = Track.ArtistId </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    INNER JOIN InvoiceLine ON Track.TrackId = InvoiceLine.TrackId </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    GROUP BY Artist.Name </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ORDER BY TotalQuantity DESC </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    LIMIT 3;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I now know the final answer.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action: query_sql_db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Action Input: SELECT Artist.Name, SUM(InvoiceLine.Quantity) AS TotalQuantity FROM Artist INNER JOIN Album ON Artist.ArtistId = Album.ArtistId INNER JOIN Track ON Album.AlbumId = Track.AlbumId INNER JOIN InvoiceLine ON Track.TrackId = InvoiceLine.TrackId GROUP BY Artist.Name ORDER BY TotalQuantity DESC LIMIT 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Observation: [(&#x27;Iron Maiden&#x27;, 140), (&#x27;U2&#x27;, 107), (&#x27;Metallica&#x27;, 91)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Thought: I now know the final answer.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Final Answer: The top 3 best selling artists are Iron Maiden, U2, and Metallica.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &gt; Finished chain.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &#x27;The top 3 best selling artists are Iron Maiden, U2, and Metallica.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hwchase17/langchainjs/edit/main/docs/docs/modules/agents/tools/toolkits/integrations/sql_database.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/spark_sql"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Spark SQL Agent</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/langchain-docs-scratch/docs/modules/agents/tools/toolkits/integrations/vectorstore"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Vectorstore Agent</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#initialization" class="table-of-contents__link toc-highlight">Initialization</a></li><li><a href="#example-describing-a-table" class="table-of-contents__link toc-highlight">Example: describing a table</a></li><li><a href="#example-describing-a-table-recovering-from-an-error" class="table-of-contents__link toc-highlight">Example: describing a table, recovering from an error</a></li><li><a href="#example-running-queries" class="table-of-contents__link toc-highlight">Example: running queries</a></li><li><a href="#recovering-from-an-error" class="table-of-contents__link toc-highlight">Recovering from an error</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/cU2adEyC7w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/LangChainAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hwchase17/langchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/hwchase17/langchainjs" target="_blank" rel="noopener noreferrer" class="footer__link-item">JS/TS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://langchain.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Homepage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.langchain.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 LangChain, Inc.</div></div></div></footer></div>
<script src="/langchain-docs-scratch/assets/js/runtime~main.2adc7ca8.js"></script>
<script src="/langchain-docs-scratch/assets/js/main.f4d0c746.js"></script>
</body>
</html>