"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[56124],{3905:(n,e,t)=>{t.d(e,{Zo:()=>d,kt:()=>g});var o=t(67294);function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,o)}return t}function r(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){a(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,o,a=function(n,e){if(null==n)return{};var t,o,a={},i=Object.keys(n);for(o=0;o<i.length;o++)t=i[o],e.indexOf(t)>=0||(a[t]=n[t]);return a}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(o=0;o<i.length;o++)t=i[o],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(a[t]=n[t])}return a}var l=o.createContext({}),c=function(n){var e=o.useContext(l),t=e;return n&&(t="function"==typeof n?n(e):r(r({},e),n)),t},d=function(n){var e=c(n.components);return o.createElement(l.Provider,{value:e},n.children)},h="mdxType",u={inlineCode:"code",wrapper:function(n){var e=n.children;return o.createElement(o.Fragment,{},e)}},p=o.forwardRef((function(n,e){var t=n.components,a=n.mdxType,i=n.originalType,l=n.parentName,d=s(n,["components","mdxType","originalType","parentName"]),h=c(t),p=a,g=h["".concat(l,".").concat(p)]||h[p]||u[p]||i;return t?o.createElement(g,r(r({ref:e},d),{},{components:t})):o.createElement(g,r({ref:e},d))}));function g(n,e){var t=arguments,a=e&&e.mdxType;if("string"==typeof n||a){var i=t.length,r=new Array(i);r[0]=p;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=n,s[h]="string"==typeof n?n:a,r[1]=s;for(var c=2;c<i;c++)r[c]=t[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},50059:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var o=t(87462),a=(t(67294),t(3905));const i={},r="Tracing",s={unversionedId:"modules/callbacks/how_to/tracing",id:"modules/callbacks/how_to/tracing",title:"Tracing",description:"There are two recommended ways to trace your LangChains:",source:"@site/docs/modules/callbacks/how_to/tracing.md",sourceDirName:"modules/callbacks/how_to",slug:"/modules/callbacks/how_to/tracing",permalink:"/langchain-docs-scratch/docs/modules/callbacks/how_to/tracing",draft:!1,editUrl:"https://github.com/hwchase17/langchainjs/edit/main/docs/docs/modules/callbacks/how_to/tracing.md",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Token counting",permalink:"/langchain-docs-scratch/docs/modules/callbacks/how_to/token_counting"},next:{title:"Argilla",permalink:"/langchain-docs-scratch/docs/modules/callbacks/integrations/argilla"}},l={},c=[],d=(h="CodeOutputBlock",function(n){return console.warn("Component "+h+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",n)});var h;const u={toc:c},p="wrapper";function g(n){let{components:e,...t}=n;return(0,a.kt)(p,(0,o.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"tracing"},"Tracing"),(0,a.kt)("p",null,"There are two recommended ways to trace your LangChains:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Setting the ",(0,a.kt)("inlineCode",{parentName:"li"},"LANGCHAIN_TRACING")," environment variable to ",(0,a.kt)("inlineCode",{parentName:"li"},'"true"'),". "),(0,a.kt)("li",{parentName:"ol"},"Using a context manager ",(0,a.kt)("inlineCode",{parentName:"li"},"with tracing_enabled()")," to trace a particular block of code.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note")," if the environment variable is set, all code will be traced, regardless of whether or not it's within the context manager."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'import os\n\nfrom langchain.agents import AgentType, initialize_agent, load_tools\nfrom langchain.callbacks import tracing_enabled\nfrom langchain.llms import OpenAI\n\n# To run the code, make sure to set OPENAI_API_KEY and SERPAPI_API_KEY\nllm = OpenAI(temperature=0)\ntools = load_tools(["llm-math", "serpapi"], llm=llm)\nagent = initialize_agent(\n    tools, llm, agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=True\n)\n\nquestions = [\n    "Who won the US Open men\'s final in 2019? What is his age raised to the 0.334 power?",\n    "Who is Olivia Wilde\'s boyfriend? What is his current age raised to the 0.23 power?",\n    "Who won the most recent formula 1 grand prix? What is their age raised to the 0.23 power?",\n    "Who won the US Open women\'s final in 2019? What is her age raised to the 0.34 power?",\n    "Who is Beyonce\'s husband? What is his age raised to the 0.19 power?",\n]\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'os.environ["LANGCHAIN_TRACING"] = "true"\n\n# Both of the agent runs will be traced because the environment variable is set\nagent.run(questions[0])\nwith tracing_enabled() as session:\n    assert session\n    agent.run(questions[1])\n')),(0,a.kt)(d,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    WARNING:root:Failed to load default session, using empty session: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /sessions?name=default (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f8b36d0>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n    \n    \n    > Entering new AgentExecutor chain...\n     I need to find out who won the US Open men's final in 2019 and then calculate his age raised to the 0.334 power.\n    Action: Search\n    Action Input: \"US Open men's final 2019 winner\"\n    Observation: Rafael Nadal defeated Daniil Medvedev in the final, 7\u20135, 6\u20133, 5\u20137, 4\u20136, 6\u20134 to win the men's singles tennis title at the 2019 US Open. It was his fourth US ...\n    Thought: I need to find out the age of the winner\n    Action: Search\n    Action Input: \"Rafael Nadal age\"\n    Observation: 37 years\n    Thought: I now need to calculate the age raised to the 0.334 power\n    Action: Calculator\n    Action Input: 37^0.334\n    Observation: Answer: 3.340253100876781\n    Thought:\n\n    WARNING:root:Failed to persist run: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /chain-runs (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f8c0f50>: Failed to establish a new connection: [Errno 61] Connection refused'))\n    WARNING:root:Failed to load default session, using empty session: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /sessions?name=default (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f8e6f50>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n     I now know the final answer\n    Final Answer: Rafael Nadal, aged 37, won the US Open men's final in 2019 and his age raised to the 0.334 power is 3.340253100876781.\n    \n    > Finished chain.\n    \n    \n    > Entering new AgentExecutor chain...\n     I need to find out who Olivia Wilde's boyfriend is and then calculate his age raised to the 0.23 power.\n    Action: Search\n    Action Input: \"Olivia Wilde boyfriend\"\n    Observation: Sudeikis and Wilde's relationship ended in November 2020. Wilde was publicly served with court documents regarding child custody while she was presenting Don't Worry Darling at CinemaCon 2022. In January 2021, Wilde began dating singer Harry Styles after meeting during the filming of Don't Worry Darling.\n    Thought: I need to find out Harry Styles' age.\n    Action: Search\n    Action Input: \"Harry Styles age\"\n    Observation: 29 years\n    Thought: I need to calculate 29 raised to the 0.23 power.\n    Action: Calculator\n    Action Input: 29^0.23\n    Observation: Answer: 2.169459462491557\n    Thought:\n\n    WARNING:root:Failed to persist run: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /chain-runs (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f8fa590>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n     I now know the final answer.\n    Final Answer: Harry Styles is Olivia Wilde's boyfriend and his current age raised to the 0.23 power is 2.169459462491557.\n    \n    > Finished chain.\n"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'# Now, we unset the environment variable and use a context manager.\n\nif "LANGCHAIN_TRACING" in os.environ:\n    del os.environ["LANGCHAIN_TRACING"]\n\n# here, we are writing traces to "my_test_session"\nwith tracing_enabled("my_test_session") as session:\n    assert session\n    agent.run(questions[0])  # this should be traced\n\nagent.run(questions[1])  # this should not be traced\n')),(0,a.kt)(d,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    WARNING:root:Failed to load my_test_session session, using empty session: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /sessions?name=my_test_session (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f8e41d0>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n    \n    \n    > Entering new AgentExecutor chain...\n     I need to find out who won the US Open men's final in 2019 and then calculate his age raised to the 0.334 power.\n    Action: Search\n    Action Input: \"US Open men's final 2019 winner\"\n    Observation: Rafael Nadal defeated Daniil Medvedev in the final, 7\u20135, 6\u20133, 5\u20137, 4\u20136, 6\u20134 to win the men's singles tennis title at the 2019 US Open. It was his fourth US ...\n    Thought: I need to find out the age of the winner\n    Action: Search\n    Action Input: \"Rafael Nadal age\"\n    Observation: 37 years\n    Thought: I now need to calculate the age raised to the 0.334 power\n    Action: Calculator\n    Action Input: 37^0.334\n    Observation: Answer: 3.340253100876781\n    Thought:\n\n    WARNING:root:Failed to persist run: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /chain-runs (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f8d0a50>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n     I now know the final answer\n    Final Answer: Rafael Nadal, aged 37, won the US Open men's final in 2019 and his age raised to the 0.334 power is 3.340253100876781.\n    \n    > Finished chain.\n    \n    \n    > Entering new AgentExecutor chain...\n     I need to find out who Olivia Wilde's boyfriend is and then calculate his age raised to the 0.23 power.\n    Action: Search\n    Action Input: \"Olivia Wilde boyfriend\"\n    Observation: Sudeikis and Wilde's relationship ended in November 2020. Wilde was publicly served with court documents regarding child custody while she was presenting Don't Worry Darling at CinemaCon 2022. In January 2021, Wilde began dating singer Harry Styles after meeting during the filming of Don't Worry Darling.\n    Thought: I need to find out Harry Styles' age.\n    Action: Search\n    Action Input: \"Harry Styles age\"\n    Observation: 29 years\n    Thought: I need to calculate 29 raised to the 0.23 power.\n    Action: Calculator\n    Action Input: 29^0.23\n    Observation: Answer: 2.169459462491557\n    Thought: I now know the final answer.\n    Final Answer: Harry Styles is Olivia Wilde's boyfriend and his current age raised to the 0.23 power is 2.169459462491557.\n    \n    > Finished chain.\n\n\n\n\n\n    \"Harry Styles is Olivia Wilde's boyfriend and his current age raised to the 0.23 power is 2.169459462491557.\"\n"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'import asyncio\n\n# The context manager is concurrency safe:\nif "LANGCHAIN_TRACING" in os.environ:\n    del os.environ["LANGCHAIN_TRACING"]\n\n# start a background task\ntask = asyncio.create_task(agent.arun(questions[0]))  # this should not be traced\nwith tracing_enabled() as session:\n    assert session\n    tasks = [agent.arun(q) for q in questions[1:3]]  # these should be traced\n    await asyncio.gather(*tasks)\n\nawait task\n')),(0,a.kt)(d,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    WARNING:root:Failed to load default session, using empty session: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /sessions?name=default (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f916ed0>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n    \n    \n    > Entering new AgentExecutor chain...\n    \n    \n    > Entering new AgentExecutor chain...\n    \n    \n    > Entering new AgentExecutor chain...\n     I need to find out who Olivia Wilde's boyfriend is and then calculate his age raised to the 0.23 power.\n    Action: Search\n    Action Input: \"Olivia Wilde boyfriend\" I need to find out who won the grand prix and then calculate their age raised to the 0.23 power.\n    Action: Search\n    Action Input: \"Formula 1 Grand Prix Winner\" I need to find out who won the US Open men's final in 2019 and then calculate his age raised to the 0.334 power.\n    Action: Search\n    Action Input: \"US Open men's final 2019 winner\"\n    Observation: Sudeikis and Wilde's relationship ended in November 2020. Wilde was publicly served with court documents regarding child custody while she was presenting Don't Worry Darling at CinemaCon 2022. In January 2021, Wilde began dating singer Harry Styles after meeting during the filming of Don't Worry Darling.\n    Thought:\n    Observation: Rafael Nadal defeated Daniil Medvedev in the final, 7\u20135, 6\u20133, 5\u20137, 4\u20136, 6\u20134 to win the men's singles tennis title at the 2019 US Open. It was his fourth US ...\n    Thought:\n    Observation: The first Formula One World Drivers' Champion was Giuseppe Farina in the 1950 championship and the current title holder is Max Verstappen in the 2022 season.\n    Thought: I need to find out Harry Styles' age.\n    Action: Search\n    Action Input: \"Harry Styles age\" I need to find out the age of the winner\n    Action: Search\n    Action Input: \"Rafael Nadal age\"\n    Observation: 29 years\n    Thought:\n    Observation: 37 years\n    Thought: I need to find out Max Verstappen's age.\n    Action: Search\n    Action Input: \"Max Verstappen Age\" I need to calculate 29 raised to the 0.23 power.\n    Action: Calculator\n    Action Input: 29^0.23 I now need to calculate the age raised to the 0.334 power\n    Action: Calculator\n    Action Input: 37^0.334\n    Observation: Answer: 2.169459462491557\n    Thought:\n    Observation: 25 years\n    Thought:\n    Observation: Answer: 3.340253100876781\n    Thought:\n\n    WARNING:root:Failed to persist run: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /chain-runs (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f95dbd0>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n     I now know the final answer.\n    Final Answer: Harry Styles is Olivia Wilde's boyfriend and his current age raised to the 0.23 power is 2.169459462491557.\n    \n    > Finished chain.\n     I need to calculate 25 raised to the 0.23 power.\n    Action: Calculator\n    Action Input: 25^0.23 I now know the final answer\n    Final Answer: Rafael Nadal, aged 37, won the US Open men's final in 2019 and his age raised to the 0.334 power is 3.340253100876781.\n    \n    > Finished chain.\n    \n    Observation: Answer: 2.096651272316035\n    Thought:\n\n    WARNING:root:Failed to persist run: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /chain-runs (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x12f95de50>: Failed to establish a new connection: [Errno 61] Connection refused'))\n\n\n     I now know the final answer.\n    Final Answer: Max Verstappen, aged 25, won the most recent Formula 1 Grand Prix and his age raised to the 0.23 power is 2.096651272316035.\n    \n    > Finished chain.\n\n\n\n\n\n    \"Rafael Nadal, aged 37, won the US Open men's final in 2019 and his age raised to the 0.334 power is 3.340253100876781.\"\n"))))}g.isMDXComponent=!0}}]);